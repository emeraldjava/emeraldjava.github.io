---
title: Extending ANT JUnitTask

category: blogger
# Pulled from Blogger. Last updated there on: Fri Jul 13 15:18:00 IST 2007
---
I needed to run the JUnitTask from code (since i needed to create a custom FileSet for the BatchTest). I started out with a plan Task, but while the code below runs the classpath details that the task uses are incorrect. <br /><br /><pre class="prettyprint"><br />public class JunitTestExistsTask extends Task {<br /><br />  private void runAntJUnitTests()<br />    throws BuildException {<br />    <br />    try<br />    {<br />      JUnitTask jUnitTask = new JUnitTask();<br />      jUnitTask.setOutputToFormatters(true);<br />      jUnitTask.setProject(getProject());<br />      jUnitTask.setShowOutput(true);<br />      jUnitTask.setFork(true);<br /><br />      FormatterElement formatterElement = new FormatterElement();<br />      TypeAttribute typeAttribute = new TypeAttribute();<br />      typeAttribute.setValue("xml");<br />      formatterElement.setType(typeAttribute);<br />      jUnitTask.addFormatter(formatterElement);<br /><br />      BatchTest batchtest = super.createBatchTest();<br />      File results = new File(getProject().getProperty("dir.test.results"));<br />      batchtest.setTodir(results);<br />      batchtest.addFileSet(createFileSet());<br /><br />      log("runAntJUnitTests --> execute()");<br />      jUnitTask.execute();<br />    }<br />    catch(Throwable e)<br />    {<br />      e.printStackTrace();<br />      throw new BuildException(e);<br />    }<br />  }<br />}<br /></pre><br /><br />I wanted to avoid having to set the classpath in code, so i took another aproach to the issue. I decided my Task would extend from the JUnitTask, this allows me to keep that majority of the task config in xml, and reuse the default handling of classpaths and jvm args. <br /><br /><pre class="prettyprint"><br />public class JunitTestExistsTask extends JUnitTask {<br /><br />  /**<br />   * Add the test files to a BatchTest and start the JUnit process.<br />   * @throws BuildException<br />   */<br />  private void runAntJUnitTests()<br />    throws BuildException {    <br />    try {<br />      BatchTest batchtest = super.createBatchTest();<br />      File results = new File(getProject().getProperty("dir.test.results"));<br /><br />      batchtest.setTodir(results);<br />      batchtest.addFileSet(createFileSet());<br />      super.execute();      <br />    } catch (Exception e) {<br />      throw new BuildException(e);<br />    }<br />  }<br />}<br /></pre><br /><br />The xml for this command<br /><br /><pre name="code" class="xml"><br /><target name="uiclaims.policing.junit"><br />  <taskdef <br />      name="junitTestsExist" <br />      classname="curam.uic.tools.policing.junit.JunitTestExistsTask" <br />      classpathref="junit.target.cp"/><br />  <junitTestsExist source="junit.activity.txt" fork="${junit.fork}" timeout="${junit.timeout}" maxmemory="${junit.maxmemory}" printsummary="${junit.printsummary}" showoutput="${junit.showoutput}" failureproperty="tests.failed"><br />    <classpath refid="junit.target.cp"/><br /><br />    <formatter type="xml"/><br /><br />  </junitTestsExist><br /><br /></target><br /><br /></pre>
